local load = require(game.ReplicatedStorage.Fsys).load

_G.iPad_scriptExecuted = _G.iPad_scriptExecuted or false
if _G.iPad_scriptExecuted then
	load("UIManager").apps.DialogApp:dialog({
		["text"] = "Script alredy executed.",
		["button"] = "Okay"
	})
	return
end
_G.iPad_scriptExecuted = true

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local LocalPlayer = Players.LocalPlayer

local TradeApp = require(ReplicatedStorage.ClientModules.Core.UIManager.Apps.TradeApp)
local BackpackApp = require(ReplicatedStorage.ClientModules.Core.UIManager.Apps.BackpackApp.BackpackApp)
local InventoryDB = require(ReplicatedStorage.ClientDB.Inventory.InventoryDB)
local petDatabase = require(ReplicatedStorage.ClientDB.Inventory.InventoryDB).pets
local getData = require(ReplicatedStorage.ClientModules.Core.ClientData).get_data

local RouterClient = load("RouterClient")
local ColorThemeManager = load("ColorThemeManager")
local ClientData = load("ClientData")
local SendTradeRequest = RouterClient.get("TradeAPI/SendTradeRequest")
local DeclineTrade = RouterClient.get("TradeAPI/DeclineTrade")

local get_class = function(Module)
	if Module == "DepthButton" then
		return require(game.ReplicatedStorage.ClientModules.Core.UIManager.Elements.Buttons.DepthButton)
	end
	if Module == "BackpackApp" then
		return require(game.ReplicatedStorage.ClientModules.Core.UIManager.Apps.BackpackApp.BackpackApp)
	end
	if Module == "CustomButton" then
		return require(game.ReplicatedStorage.ClientModules.Core.UIManager.Elements.Buttons.CustomButton)
	end
end;
local function Wrap(p23, p24)
	return get_class(p24).new({
		["cache"] = {},
		["apps"] = {
			"TradeApp"
		}
	}, p23);
end



local_offer = nil
local func
local old1
local old2
local old3
local old4
local old5
local petstbl = {
	"Bat Dragon",
	"Frost Dragon",
	"Shadow Dragon",
	"Giraffe",
	"Owl",
	"Parrot",
	"Crow",
	"Evil Unicorn",
	"Arctic Reindeer",
	"Diamond Butterfly",
	"Hedgehog",
	"Balloon Unicorn",
	"Blazing Lion",
	"Dalmatian",
	"Orchid Butterfly",
	"Turtle",
	"Pelican",
	"Monkey King",
	"Albino Monkey",
	"Haetae",
	"Frostbite Bear",
	"Strawberry Shortcake Bat Dragon",
	"Hot Doggo",
	"Chocolate Chip Bat Dragon",
	"Kangaroo",
	"Cow",
	"Pirate Ghost Capuchin Monkey",
	"Flamingo",
	"African Wild Dog",
	"Peppermint Penguin",
	"Lion",
	"Crocodile",
	"Elephant",
	"Blue Dog",
	"Caterpillar",
	"Frost Fury",
	"Lava Dragon",
	"Golden Penguin",
	"Candyfloss Chick",
	"Nessie",
	"Vampire Dragon",
	"Winged Tiger",
	"Sugar Glider",
	"Mechapup",
	"Fairy Bat Dragon",
	"Undead Jousting Horse",
	"Cupid Dragon",
	"Golden Chow-Chow",
	"Mini Pig",
	"Irish Water Spaniel",
	"Goat",
	"Glacier Moth",
	"Sheeeeep",
	"Goose",
	"Pig",
	"Pink Cat",
	"Meerkat"
}
local function get_platform()
	local userInputService = game:GetService("UserInputService")
	if userInputService.TouchEnabled then
		return "mobile"
	else
		return "pc"
	end
end
for k,v in pairs(getgc(true)) do
	if typeof(v) == "table" and rawget(v,"trade") then
		for kk,vv in pairs(v['trade']) do
			if typeof(tonumber(kk)) == "number" then
				func = vv
			end
		end
	end
end
old1 = hookfunction(TradeApp._change_local_trade_state,function(a,b)
	for k,v in pairs(b) do
		if k == "sender_offer" or k == "recipient_offer" then
			for kk,vv in pairs(v) do
				if kk == "items" then
					local_offer = v.items
				end
			end
		else

		end
	end
	return old1(a,b)
end)
old2 = hookfunction(TradeApp._overwrite_local_trade_state,function(a,b)
	if a~=nil and b~= nil and local_offer ~= nil then
		if game.Players.LocalPlayer == b.sender then
			b.sender_offer.items = local_offer
		else
			b.recipient_offer.items = local_offer
		end
	end
	return old2(a,b)
end)
old3 = hookfunction(TradeApp._remove_item_from_my_offer,function(p174, p175)
	local function findKey(alltables,needtable)
		for k,v in pairs(alltables) do
			if v["unique"] == needtable["unique"] then
				return k
			end
		end
	end
	if p175.category == "houses" then
		p174.UIManager.apps.HintApp:hint({
			["text"] = "You can't remove this item.",
			["length"] = 5,
			["overridable"] = true
		})
	else
		RouterClient.get("TradeAPI/RemoveItemFromOffer"):FireServer(p175.unique)
		local v176, v177 = p174:_get_my_offer()
		local v178 = findKey(v176.items,p175)
		table.remove(v176.items, v178)
		local v179 = {
			[v177] = {
				["items"] = v176.items
			}
		}
		p174:_change_local_trade_state(v179)
		p174:_lock_trade_for_appropriate_time()
		p174:refresh_all()
	end
end)
old4 = hookfunction(func,function(...)
	local args = {...}
	if #args > 2 then
		for k,v in pairs(args) do
			if typeof(v) == "table" then
				if local_offer ~= nil then
					if game.Players.LocalPlayer == v.sender then
						v["sender_offer"]["items"] = local_offer
					else
						v["recipient_offer"]["items"] = local_offer
					end
				end
			end
		end
	else
	end
	return old4(unpack(args))
end)
old5 = hookfunction(TradeApp.hide,function(...)
	if local_offer ~= nil then
		for k,v in pairs(ClientData.get("inventory")["pets"]) do
			for kk,vv in pairs(local_offer) do
				if vv['unique'] == k then
					ClientData.get("inventory")["pets"][k] = nil
				end
			end
		end
	end
	local_offer = nil
	return old5(...)
end)


getgenv().UsedAges = getgenv().UsedAges or {}
local function getUniqueRandomAge()
	local age
	repeat
		age = math.random(1, 2000000)
	until not getgenv().UsedAges[age]
	getgenv().UsedAges[age] = true
	return age
end
local function makePetPattern(id, kind, unique, neon, mega, fly, ride, stacks)
	local ageRandom = 3
	if not stacks then
		ageRandom = getUniqueRandomAge()
	end
	if neon then
		neon = true
		mega = false
	elseif mega then
		neon = false
		mega = true
	end
	return {
		["unique"] = unique,
		["category"] = "pets",
		["id"] = id,
		["kind"] = kind,
		["properties"] = {
			["pet_trick_level"] = 0,
			["rideable"] = false,
			["friendship_level"] = 0,
			["age"] = ageRandom,
			["flyable"] = fly,
			["rideable"] = ride,
			["neon"] = neon,
			["mega_neon"] = mega,
			["ailments_completed"] = 0
		},
		["newness_order"] = 0
	}
end
local usedUniques = {}
local function createUnique()
	local chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789"
	local Unique
	repeat
		Unique = ""
		for i = 1, 16 do
			Unique = Unique .. chars:sub(math.random(1, #chars), math.random(1, #chars))
		end
	until not usedUniques[Unique]
	usedUniques[Unique] = true
	return "2_" .. Unique .. "_iPad"
end
local function createPet(name,fly,ride,neon,meganeon, stacks)
	for k,v in pairs(InventoryDB.pets) do
		if v["name"]:lower() == name:lower() then
			local uniq = createUnique()
			ClientData.get("inventory")["pets"][uniq] = makePetPattern(v['id'],v['kind'],uniq,neon,meganeon,fly,ride, stacks)
		end
	end
end

local ImGui =  loadstring(game:HttpGet('https://raw.githubusercontent.com/i42110743/dfsvdsvdsewfwe/refs/heads/main/sdfdsvdsvvdsvd'))()
local Window = ImGui:CreateWindow({
	Title = "Adopt Me | Helper",
	Size = UDim2.new(0, 200, 0, 250),
	Position = UDim2.new(0.10, 0, 0, 70)
})
Window:Center()
local AdoptMeHelper = {
	Trades = {
		SelectedTradePlayer = nil
	},
	Misc = {
		SelectedBlockAndFakeTradesPlayer = nil
	},
	Inv = {
		Pets = {
			flyable = false,
			rideable = false,
			neon = false,
			mega_neon = false,
			stack = false
		}
	},
	FakeTrades = {
		PartnerName = nil,
		Friend = false
	}
}
local userIds = {
	6084968701,
	5176928854,
	7548309009,
	617157690,
	5019576643,
	7927883444,
	9413304211,
	5838310384,
	1604359853,
	6160630614,
	1828750928
}
local TradeTab = Window:CreateTab({
	Name = "Trade",
	Visible = true
})
TradeTab:Separator({Text = "Actions"})
local TradePlayerCombo = TradeTab:Combo({
	Placeholder = "Select player",
	Label = "(0)",
	Items = {},
	Callback = function(self, Value)
		AdoptMeHelper.Trades.SelectedTradePlayer = Players[Value]
	end
})
TradeTab:InputText({
	PlaceHolder = "Search player",
	Callback = function(self, text)
		local filtered = {}
		for _, plr in ipairs(Players:GetPlayers()) do
			if text == "" or string.find(plr.Name:lower(), text:lower()) then
				filtered[plr.Name] = plr.Name
			end
		end
		TradePlayerCombo.Items = filtered
	end
})
TradeTab:Button({
	Text = "Send Trade",
	Callback = function()
		if AdoptMeHelper.Trades.SelectedTradePlayer then
			SendTradeRequest:FireServer(AdoptMeHelper.Trades.SelectedTradePlayer)
		end
	end
})
TradeTab:Button({
	Text = "Decline Trade",
	Callback = function()
		if AdoptMeHelper.Trades.SelectedTradePlayer then
			DeclineTrade:FireServer()
		end
	end
})
TradeTab:Button({
	Text = "Open Profile",
	Callback = function()
		if AdoptMeHelper.Trades.SelectedTradePlayer then
			local Id = Players:GetUserIdFromNameAsync(AdoptMeHelper.Trades.SelectedTradePlayer.Name)
			load("UIManager").apps.PlayerProfileApp:open_player_profile_for_user_id(Id)
		end
	end
})


local PetsTab = Window:CreateTab({
	Name = "Inv",
	Visible = false
})
PetsTab:Separator({Text = "Spawn high tier pets"})

local flyable = AdoptMeHelper.Inv.Pets.flyable
local rideable = AdoptMeHelper.Inv.Pets.rideable
local mega_neon = AdoptMeHelper.Inv.Pets.mega_neon
local neon = AdoptMeHelper.Inv.Pets.neon
local stack = AdoptMeHelper.Inv.Pets.stack

PetsTab:Checkbox({
	Label = "Fly",
	Value = flyable,
	Callback = function(self, Value)
		flyable = Value
	end,
})
PetsTab:Checkbox({
	Label = "Ride",
	Value = rideable,
	Callback = function(self, Value)
		rideable = Value
	end,
})
PetsTab:Checkbox({
	Label = "Neon",
	Value = neon,
	Callback = function(self, Value)
		neon = Value
	end,
})
PetsTab:Checkbox({
	Label = "Mega Neon",
	Value = mega_neon,
	Callback = function(self, Value)
		mega_neon = Value
	end,
})

PetsTab:Checkbox({
	Label = "Stack",
	Value = stack,
	Callback = function(self, Value)
		stack = Value
	end,
})
PetsTab:Button({
	Text = "Spawn pets",
	Callback = function(self)
		for _,namepet in pairs(petstbl) do
			for i = 1, math.random(1, 2) do
				createPet(namepet, flyable, rideable, neon, mega_neon, stack)
			end
		end
	end,
})

PetsTab:Button({
	Text = "Spawn pets - FR",
	Callback = function(self)
		for _,namepet in pairs(petstbl) do
			for i = 1, math.random(1, 2) do
				createPet(namepet, true, true, false, false, stack)
			end
		end
	end,
})

PetsTab:Button({
	Text = "Spawn pets - NFR",
	Callback = function(self)
		for _,namepet in pairs(petstbl) do
			for i = 1, math.random(1, 2) do
				createPet(namepet, true, true, true, false, stack)
			end
		end
	end,
})

PetsTab:Button({
	Text = "Spawn pets - MFR",
	Callback = function(self)
		for _,namepet in pairs(petstbl) do
			for i = 1, math.random(1, 2) do
				createPet(namepet, true, true, false, true, stack)
			end
		end
	end,
})
PetsTab:Separator({Text = "Misc"})
PetsTab:Button({
	Text = "Sort pets",
	Callback = function(self)
		for Pet, PetData in pairs(getData()[LocalPlayer.Name].inventory.pets) do
			PetData.newness_order = 0
			PetData.age = 1000
		end
	end,
})



local function getPlayerByNameInsensitive(name)
	name = string.lower(name)
	for _, player in ipairs(Players:GetPlayers()) do
		if string.lower(player.Name) == name then
			return player
		end
	end
	return nil
end
local EnterApetName = nil
local NameText = nil
local StartTradeButton = nil
local ScrollingFrame = nil
local functionStartTrade
local Mock = LocalPlayer.PlayerGui:FindFirstChild("MockTradeControl")
for _, Frame in pairs(Mock:GetDescendants()) do
	if Frame:IsA("TextBox") and Frame.PlaceholderText == "Enter pet name..." then
		EnterApetName = Frame
	end
	if Frame:IsA("TextBox") and Frame.Text == "Idk" then
		NameText = Frame
	end
	if Frame:IsA("TextButton") and Frame.Text == "Start Trade" then
		StartTradeButton = Frame
		for i, connection in ipairs(getconnections(StartTradeButton.MouseButton1Click)) do
			functionStartTrade = connection.Function
		end
	end
	if Frame:IsA("ScrollingFrame") then
		ScrollingFrame = Frame
	end
end
local MiscTab = Window:CreateTab({
	Name = "Misc",
	Visible = false
})
MiscTab:Separator({Text = "Block players"})
local BlockPlayerCombo = MiscTab:Combo({
	Placeholder = "Select player",
	Label = "(0)",
	Items = {},
	Callback = function(self, Value)
		AdoptMeHelper.Misc.SelectedBlockAndFakeTradesPlayer = Players[Value]
	end
})
local TradePart = LocalPlayer.PlayerGui.TradeApp.Frame.NegotiationFrame.Header.PartnerFrame.NameLabel
local blockPlayerSearch = MiscTab:InputText({
	PlaceHolder = "Search player",
	Callback = function(self, text)
		local filtered = {}
		for _, plr in ipairs(Players:GetPlayers()) do
			if text == "" or string.find(plr.Name:lower(), text:lower()) then
				filtered[plr.Name] = plr.Name
			end
		end
		BlockPlayerCombo.Items = filtered
	end
})
MiscTab:Button({
	Text = "Select trade player",
	Callback = function()
		pcall(function()
			local Selected = getPlayerByNameInsensitive(TradePart.Text)
			BlockPlayerCombo:SetPlaceholder(Selected.Name)
			AdoptMeHelper.Misc.SelectedBlockAndFakeTradesPlayer = Selected
		end)
	end
})
MiscTab:Button({
	Text = "Block player",
	Callback = function()
		pcall(function()
			local Selected = AdoptMeHelper.Misc.SelectedBlockAndFakeTradesPlayer

			game:GetService('StarterGui'):SetCore('PromptBlockPlayer', Selected)
			repeat game:GetService('RunService').Heartbeat:Wait() until game:GetService('CoreGui'):FindFirstChild('BlockingModalScreen')
			game:GetService('CoreGui').BlockingModalScreen.BlockingModalContainer.BlockingModalContainerWrapper.BlockingModal.BackgroundTransparency = 1
			game:GetService('CoreGui').BlockingModalScreen.BlockingModalContainer.BlockingModalContainerWrapper.BackgroundTransparency = 1
			game:GetService('CoreGui').BlockingModalScreen.BlockingModalContainer.BackgroundTransparency = 1
			game:GetService("CoreGui").BlockingModalScreen.BlockingModalContainer.BlockingModalContainerWrapper.BlockingModal.AlertModal.Position = UDim2.new(0.00800000038, -110, 0.5, 0)
		end)
	end
})

MiscTab:Separator({Text = "Fake Trade"})


local usedNamesds = {}
local RandomName = nil
MiscTab:Button({
	Text = "Make random name trade",
	Callback = function(self)
		local randomIndex = math.random(1, #userIds)
		local userid = userIds[randomIndex]
		local success, friendPages = pcall(function()
			return Players:GetFriendsAsync(userid)
		end)
		if success and friendPages then
			local friends = friendPages:GetCurrentPage()
			local availableFriends = {}
			for _, friend in ipairs(friends) do
				if not usedNamesds[friend.Username] then
					table.insert(availableFriends, friend)
				end
			end
			if #availableFriends > 0 then
				local chosen = availableFriends[math.random(1, #availableFriends)]
				usedNamesds[chosen.Username] = true
				RandomName = chosen.Username
				NameText.Text = chosen.Username
			end
		end
	end
})
MiscTab:Button({
	Text = "Make Dialog Trade",
	Callback = function(self)
		local name = NameText.Text or RandomName
		local dialogApp = load("UIManager").apps.DialogApp:dialog({
			["text"] = name .. " sent you a trade request",
			["left"] = "Decline",
			["right"] = "Accept",
		})
		if dialogApp == "Accept" then
			functionStartTrade()
		end
	end
})
local PetListComboHighTier = MiscTab:Combo({
	Placeholder = "Pet list to fake trade",
	Label = "?",
	Items = {
		["Bat Dragon"] = "Bat Dragon",
		["Shadow Dragon"] = "Shadow Dragon",
		["Frost Dragon"] = "Frost Dragon",
		["Giraffe"] = "Giraffe",
		["Crow"] = "Crow",
		["Parrot"] = "Parrot",
		["Evil Unicorn"] = "Evil Unicorn",
		["Owl"] = "Owl",
		["Dalmatian"] = "Dalmatian",
		["Turtle"] = "Turtle",
		["Crocodile"] = "Crocodile",
		["Kangaroo"] = "Kangaroo",
		["Flamingo"] = "Flamingo",
		["Chocolate Chip Bat Dragon"] = "Chocolate Chip Bat Dragon",
		["Strawberry Shortcake Bat Dragon"] = "Strawberry Shortcake Bat Dragon",
		["Balloon Unicorn"] = "Balloon Unicorn",
		["Arctic Reindeer"] = "Arctic Reindeer",
		["Albino Monkey"] = "Albino Monkey",
		["Candyfloss Chick"] = "Candyfloss Chick",
	},
	Callback = function(self, Value)
		EnterApetName.Text = Value
	end,
})



MiscTab:Separator({Text = "Misc"})
MiscTab:Button({
	Text = "Select player to trade and block",
	Callback = function(self)
		pcall(function()
			local PartnerName = getPlayerByNameInsensitive(TradePart.Text)
			AdoptMeHelper.Misc.SelectedBlockAndFakeTradesPlayer = PartnerName
			BlockPlayerCombo:SetPlaceholder(PartnerName.Name)
			for _, Frame in pairs(ScrollingFrame:GetChildren()) do
				if Frame:IsA("TextButton") then
					if Frame.TextLabel.Text == PartnerName.Name then
						for i, connection in ipairs(getconnections(Frame.MouseButton1Click)) do
							connection.Function()
						end
					end
				end
			end
		end)
	end
})

spawn(function()
	local LastPosition = nil
	game:GetService("RunService").Heartbeat:Connect(function()
		pcall(function()
			local PrimaryPart = LocalPlayer.Character.PrimaryPart
			if PrimaryPart.AssemblyLinearVelocity.Magnitude > 250 or PrimaryPart.AssemblyAngularVelocity.Magnitude > 250 then
				PrimaryPart.AssemblyAngularVelocity = Vector3.new(0, 0, 0)
				PrimaryPart.AssemblyLinearVelocity = Vector3.new(0, 0, 0)
				PrimaryPart.CFrame = LastPosition
				game.StarterGui:SetCore("ChatMakeSystemMessage", {
					Text = "You were flung. Neutralizing velocity.";
					Color = Color3.fromRGB(255, 0, 0);
				})
			elseif PrimaryPart.AssemblyLinearVelocity.Magnitude < 50 or PrimaryPart.AssemblyAngularVelocity.Magnitude > 50 then
				LastPosition = PrimaryPart.CFrame
			end
		end)
	end)
end)

local function UpdatePlayers()
	local items = {}
	for _, plr in ipairs(Players:GetPlayers()) do
		items[plr.Name] = plr.Name
	end
	BlockPlayerCombo.Items = items
	BlockPlayerCombo:SetLabel("("..#Players:GetPlayers()..")")
	TradePlayerCombo.Items = items
	TradePlayerCombo:SetLabel("("..#Players:GetPlayers()..")")
end
Players.PlayerAdded:Connect(UpdatePlayers)
Players.PlayerRemoving:Connect(UpdatePlayers)
UpdatePlayers()
